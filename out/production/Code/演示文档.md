**演示概览**

- 顶部模块: 显示与执行 SQL（只读显示系统生成 SQL，支持手动执行）
- 左侧模块:
  - 表数据浏览（users、card、merchant、consumption、recharge）
  - 用户操作（创建用户、授权，使用管理员连接执行）
- 右侧模块:
  - 基础操作（查询用户卡片余额；查询某卡消费/充值流水；设置商户停业/营业）
  - 业务办理（事务演示：模拟充值；模拟消费）
  - 视图操作（创建视图；视图查询示例；删除视图）
  - 索引操作（创建索引；删除索引）

**演示顺序**

- 准备
  - 配置数据库连接与驱动类路径，确保 campus_card 库可访问
  
- 1. 表数据浏览
  - 依次点击“用户表”“一卡通表”“商户表”“消费记录”“充值记录”，展示基础数据与字段
  - 说明实体与关系：users ↔ card（用户与卡片），card ↔ consumption/recharge（卡片与流水）
  
- 2. 基础操作
  - 查询某用户卡片及余额：输入姓名，展示用户类型、卡状态、余额
  - 查询某卡消费/充值流水：输入卡号，下拉选择“消费流水/充值流水”，展示对应明细
  - 设置商户停业/营业：输入商户 ID 切换营业状态，随后查询商户表验证变更
  
- 3. 业务办理（事务演示）
  - 模拟充值：输入卡号与金额，执行插入充值记录和更新余额的事务；随后查询卡余额验证
  - 模拟消费：输入卡号、商户 ID、金额，执行插入消费记录和扣减余额的事务；随后查询消费记录验证
  
- 4. 视图操作
  - 创建视图 user_card_info：一次性将 users 与 card 关联为统一查询入口
  - 视图查询示例：展示 user_name、user_type、card_no、card_status、card_balance、issue_time（体现视图跨表统一字段的优势）
  - 删除视图：清理演示产物，保证环境整洁
  
- 5. 索引操作
  - 创建索引 idx_card_no：为 card.card_no 的查询提速
  - 删除索引 idx_card_no：演示索引生命周期管理
  
- 6. 用户操作（左侧）
  - 创建用户：弹窗输入用户名与密码，管理员连接执行创建
  - 授权：为该用户授予最小可用查询权限（连接、schema 使用、四张核心表 SELECT）

**手动 SQL 演示**

- 挂失并补办新卡（事务，体现卡状态管理与发卡流程）

  
  ```sql
  START TRANSACTION;
  
  -- 1) 将旧卡挂失
  UPDATE campus_card.card
  SET card_status = '挂失'
  WHERE card_no = 'CARD002';
  
  -- 2) 补办新卡（同一用户，初始余额沿用旧卡）
  INSERT INTO campus_card.card (card_no, user_id, card_status, card_balance, issue_time)
  SELECT 'CARD001-NEW', user_id, '正常', card_balance, CURRENT_TIMESTAMP
  FROM campus_card.card
  WHERE card_no = 'CARD002';
  
  -- 3) 将旧卡注销
  UPDATE campus_card.card
  SET card_status = '注销'
  WHERE card_no = 'CARD002';
  
  COMMIT;
  
  -- 验证：查看两张卡状态与余额
  SELECT card_no, card_status, card_balance, issue_time
  FROM campus_card.card
  WHERE card_no IN ('CARD002', 'CARD001-NEW');
  ```

- 


  ```sql
  START TRANSACTION;
  
  -- 1) 将旧卡挂失
  UPDATE campus_card.card
  SET card_status = '挂失'
  WHERE card_no = 'CARD003';
  
  -- 2) 补办新卡（同一用户，初始余额沿用旧卡）
  INSERT INTO campus_card.card (card_no, user_id, card_status, card_balance, issue_time)
  SELECT 'CARD003-NEW', user_id, '正常', card_balance, CURRENT_TIMESTAMP
  FROM campus_card.card
  WHERE card_no = 'CARD003';
  
  -- 3) 将旧卡注销
  UPDATE campus_card.card
  SET card_status = '注销'
  WHERE card_no = 'CARD003';
  
  COMMIT;
  
  -- 验证：查看两张卡状态与余额
  SELECT card_no, card_status, card_balance, issue_time
  FROM campus_card.card
  WHERE card_no IN ('CARD003', 'CARD003-NEW');
  ```

